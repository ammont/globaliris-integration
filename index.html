<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Global Iris (HSBC payment gateway) Integration class by ammont</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Global Iris (HSBC payment gateway) Integration class</h1>
        <p>Global Iris (HSBC payment gateway) Integration Class</p>

        <p class="view"><a href="https://github.com/ammont/hsbc-globaliris-integration">View the Project on GitHub <small>ammont/hsbc-globaliris-integration</small></a></p>


        <ul>
          <li><a href="https://github.com/ammont/hsbc-globaliris-integration/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ammont/hsbc-globaliris-integration/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ammont/hsbc-globaliris-integration">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="global-iris-hsbc-payment-integration" class="anchor" href="#global-iris-hsbc-payment-integration"><span class="octicon octicon-link"></span></a>Global Iris (HSBC payment) Integration</h1>

<p>Global Iris (HSBC new payment gateway) Integration Class</p>

<p><a href="https://resourcecentre.globaliris.com/">https://resourcecentre.globaliris.com/</a></p>

<p>You can find a sample remote payment gateway in index.php, process.php is the the sender to and return.php is the reciever from 3D Secure.</p>

<p>You can also change the payment gateway configs on different scenarios based on Global Iris doc in RemotePayment.class.php using the RemotePayment::$setting static property.</p>

<p>here is the default configuration:</p>

<pre><code>array(
    's1' =&gt; 'A',
    's2' =&gt; 'A',
    's3' =&gt; 'A',
    's4' =&gt; 'N',//this should be always N
    's5' =&gt; 'A',//this should be always A
    's6' =&gt; 'A',
    's7' =&gt; 'N',//this should be always N
    's8' =&gt; 'N',
    's9' =&gt; 'N');//this should be always N
);

// 'A' is for Authorize and 'N' is for Not Authorize
</code></pre>

<p>here is the scenarios documentation: <a href="https://resourcecentre.globaliris.com/products.html?doc_id=102&amp;id=124">https://resourcecentre.globaliris.com/products.html?doc_id=102&amp;id=124</a></p>

<p>please consider that, this class is only for remote gateway, not redirect, it also has support for 3D Secure.</p>

<p>Here is how you would implement a regular payment gateway without 3D Secure:</p>

<pre><code>$payment = new RemotePayment;

$payment-&gt;setInfo($merchant, $order_id, $amount, $secret, $account);

$payment-&gt;setCartInfo($card_num, $card_exp, $card_name, $card_type, $maestro_issue, $ccv2, $presind);

$payment-&gt;authorize();
</code></pre>

<p>the authorize method will return an array with the below structure:</p>

<pre><code>array(
    'status' =&gt; 'error', // the payment result status 'success' for successful payment and 'error' for 
                        // unsuccessful payment
    'message' =&gt; 'Invalid card number', // the returned message from HSBC
    'code' =&gt; 'A' // the returned code from HSBC
);
</code></pre>

<p>Here is how you would implement a scheduled payment:</p>

<pre><code>$payment = new RemotePayment;

$payment-&gt;setInfo($merchant, $order_id, $amount, $secret, $account);

$payment-&gt;setCartInfo($card_num, $card_exp, $card_name, $card_type, $maestro_issue, $ccv2, $presind);

$payment-&gt;setSchedule($alias, $frequency, $repeats);

$payment-&gt;authorize(); // the return array will also include the schedule result
</code></pre>

<p>Here is how you would implement a payment with Adress Verification (AVS):</p>

<pre><code>$payment = new RemotePayment;

$payment-&gt;setInfo($merchant, $order_id, $amount, $secret, $account);

$payment-&gt;setCartInfo($card_num, $card_exp, $card_name, $card_type, $maestro_issue, $ccv2, $presind);

$payment-&gt;setAddressInfo($country, $street_num, $postal_code);

$payment-&gt;authorize(); // the return array will also include the AVS check result
</code></pre>

<p>Implementing the remote payment gateway with 3D Secure support needs a little more work, here is how you would do it:</p>

<p>for 3D secure we have a redirect to the issuing bank for checking the password, so we need to have 2 steps, a step for code that redirects the user to the bank and another step for returning the user from the bank and completing the payment, there is a functional sample payment gateway implemented in process.php and return.php files which you can take a look at. first lets take a look at the first step:</p>

<pre><code>$payment = new RemotePayment;

$payment-&gt;setInfo($merchant, $order_id, $amount, $secret, $account);

$payment-&gt;setCartInfo($card_num, $card_exp, $card_name, $card_type, $maestro_issue, $ccv2, $presind);

$res = $payment-&gt;send3dSecure($term_url)// $term_url is the return url which you specify.

if (is_array($res))
{
    // there was an error which the payment so RemotePayment::send3dSecure() method has returned the result array
}
else
{
    // the  first step has been successful so RemotePayment::send3dSecure() will return the redirect form which you will need to echo

    echo $res;
}
</code></pre>

<p>ok this will send the user to the bank, then the user enters his/her password and bank will return the user to the url specified by you with $term_url, when returning, The GlobalIris system will send you some parameters in $_POST which you will need to pass to RemotePayment::recieve3dSecure() method, now lets take a look at the return step:</p>

<pre><code>$payment = new RemotePayment;

$payment-&gt;setInfo($merchant, $order_id, $amount, $secret, $account);

$payment-&gt;setCartInfo($card_num, $card_exp, $card_name, $card_type, $maestro_issue, $ccv2, $presind);

$res = $payment-&gt;recieve3dSecure($_POST['PaRes'], $_POST['MD'], $merchant, $secret, $account);

if($res['status'] === 'success')
{
    echo "Thanks for your payment, your payment was successful&lt;br&gt;";
}
else
{
    echo "There was an error with your payment&lt;br&gt;";
    echo $res['message'].'&lt;br&gt;';
}
</code></pre>

<p>$res will be an array with the payment result info same as what RemotePayment::authorize() method returns, you can check $res['status'] to determine if the payment have been successful or not.</p>

<p>please note that you can set schedule or AVS check for 3d Secure payments too.</p>

<p>at last you can find a list of parameters used, along with their description:</p>

<ol>
<li>$merchant: your GlobalIris merchant id</li>
<li>$order_id: the order id to track your order, the payment will be submitted with this order id in the GlobalIris Back Office.</li>
<li>$amount: the payment amount</li>
<li>$secret: your GlobalIris secret key.</li>
<li>$account: your GlobalIris account.</li>
<li>$card_num: the payer's card number.</li>
<li>$card_exp: the payer's card expiration date.</li>
<li>$card_type: the payer's card type, supported values: VISA, MC, MAESTRO, AMEX</li>
<li>$card_name: the cardholder's name</li>
<li>$maestro_issue: issue number for MAESTRO card type, specify it only for MAESTRO cards</li>
<li>$ccv2: the CVN of the card, if you wan CVN check (CCV2 for VISA cards).</li>
<li>$presind: indicates if you want CVN check or not, 1 is for forcing CVN check.</li>
<li>$term_url: the url to return the user from 3D secure to.</li>
</ol><p>For Schedule:</p>

<ol>
<li>$alias: the alias for schedule, this will be saved with the scheduled payment, enter what better describes the payment.</li>
<li>$frequency: the schedule frequency, you can use any frequency supported by GlobalIris, you can find the list at the documentation below, example: 'monthly'
<a href="https://resourcecentre.globaliris.com/products.html?doc_id=118&amp;id=177">https://resourcecentre.globaliris.com/products.html?doc_id=118&amp;id=177</a>
</li>
<li>$repeats: number of times you want the payment to be taken.</li>
</ol><h3>
<a name="important-notice" class="anchor" href="#important-notice"><span class="octicon octicon-link"></span></a>Important Notice:</h3>

<p>I have no guaranty that this class would function properly, it might have bugs and mistakes, so you have to use it with your own responsibility and I will not accept any responsibility for any problemØŒ difficulty or damage that using my tool (this class) would cause.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/ammont">ammont</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-43176760-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>